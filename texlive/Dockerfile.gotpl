FROM {{ image "alpine" }} as build

RUN set -eux; \
   apk add --no-cache \
        {{range $key, $value := alpine_packages "rsync" "texlive-xetex" "texmf-dist-latexextra" -}}
        {{$key}}={{$value}} \
        {{end}}; \
   apk info -qL texlive-xetex | rsync -aq --files-from=- / /rootfs/; \
   apk info -qL texmf-dist-latexextra | rsync -aq --files-from=- / /rootfs/; \
   mkdir -p /rootfs/bin; \
   cp /bin/sh /rootfs/bin/sh; \
   find /rootfs -exec touch --date=@0 {} \;

FROM {{ image "base" }}

COPY --from=build /rootfs/ /