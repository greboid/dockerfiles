#!/bin/sh
set -e

CONFIG_FILE="/public/config.json"

# Build the server object
SERVER_JSON="{"

# Add server.url if set
if [ -n "$GAMJA_SERVER_URL" ]; then
    SERVER_JSON="${SERVER_JSON}\"url\":\"${GAMJA_SERVER_URL}\","
fi

# Add server.autojoin if set
if [ -n "$GAMJA_AUTOJOIN" ]; then
    SERVER_JSON="${SERVER_JSON}\"autojoin\":\"${GAMJA_AUTOJOIN}\","
fi

# Add server.auth if set
if [ -n "$GAMJA_AUTH" ]; then
    SERVER_JSON="${SERVER_JSON}\"auth\":\"${GAMJA_AUTH}\","
fi

# Add server.nick if set
if [ -n "$GAMJA_NICK" ]; then
    SERVER_JSON="${SERVER_JSON}\"nick\":\"${GAMJA_NICK}\","
fi

# Add server.autoconnect if set
if [ -n "$GAMJA_AUTOCONNECT" ]; then
    SERVER_JSON="${SERVER_JSON}\"autoconnect\":${GAMJA_AUTOCONNECT},"
fi

# Add server.ping if set
if [ -n "$GAMJA_PING" ]; then
    SERVER_JSON="${SERVER_JSON}\"ping\":${GAMJA_PING},"
fi

# Remove trailing comma and close server object
SERVER_JSON="${SERVER_JSON%,}}"

# Build final config
CONFIG_JSON="{\"server\":${SERVER_JSON}}"

# Write config file
echo "$CONFIG_JSON" > "$CONFIG_FILE"

# Execute sws
exec /sws --port 8080 --root /public
