# Generated from https://github.com/greboid/dockerfiles/blob/master/golang/Containerfile.gotpl
# BOM: {"apk:bash":"5.2.15-r5","apk:binutils":"2.40-r7","apk:brotli-libs":"1.0.9-r14","apk:busybox":"1.36.1-r2","apk:busybox-binsh":"1.36.1-r2","apk:ca-certificates":"20230506-r0","apk:curl":"8.3.0-r0","apk:gcc":"12.2.1_git20220924-r10","apk:git":"2.40.1-r0","apk:gmp":"6.2.1-r3","apk:go":"1.20.8-r0","apk:isl25":"0.25-r2","apk:libacl":"2.3.1-r3","apk:libatomic":"12.2.1_git20220924-r10","apk:libcrypto3":"3.1.3-r0","apk:libcurl":"8.3.0-r0","apk:libexpat":"2.5.0-r1","apk:libgcc":"12.2.1_git20220924-r10","apk:libgomp":"12.2.1_git20220924-r10","apk:libidn2":"2.3.4-r1","apk:libncursesw":"6.4_p20230506-r0","apk:libssl3":"3.1.3-r0","apk:libstdc++":"12.2.1_git20220924-r10","apk:libunistring":"1.1-r1","apk:libxxhash":"0.8.2-r0","apk:lz4-libs":"1.9.4-r4","apk:mpc1":"1.3.1-r1","apk:mpfr4":"4.2.0_p12-r0","apk:musl":"1.2.4-r1","apk:musl-dev":"1.2.4-r1","apk:ncurses-terminfo-base":"6.4_p20230506-r0","apk:nghttp2-libs":"1.55.1-r0","apk:pcre2":"10.42-r1","apk:popt":"1.19-r2","apk:readline":"8.2.1-r1","apk:rsync":"3.2.7-r4","apk:zlib":"1.2.13-r1","apk:zstd-libs":"1.5.5-r4","github:google/go-licenses":"v1.6.0","golang":"go1.21.1","image:alpine":"e2b43fe31f5609bc07265b709d41d65dcff433da4e96504e41fbd54861d393f9"}

FROM reg.g5d.dev/alpine@sha256:e2b43fe31f5609bc07265b709d41d65dcff433da4e96504e41fbd54861d393f9 as build

ARG GOLICENSETAG="v1.6.0"
ARG ARCHIVE_URL="https:/golang.org/dl/go1.21.1.src.tar.gz"
ARG ARCHIVE_SUM="bfa36bf75e9a1e9cbbdb9abcf9d1707e479bd3a07880a8ae3564caee5711cb99"

ENV GOPATH=/go
ENV PATH=$GOPATH/bin:/usr/local/go/bin:$PATH

RUN set -eux; \
    # Dependencies and source for bootstrapping go
    apk add  \
        bash=5.2.15-r5 \
        binutils=2.40-r7 \
        brotli-libs=1.0.9-r14 \
        busybox=1.36.1-r2 \
        busybox-binsh=1.36.1-r2 \
        ca-certificates=20230506-r0 \
        curl=8.3.0-r0 \
        gcc=12.2.1_git20220924-r10 \
        git=2.40.1-r0 \
        gmp=6.2.1-r3 \
        go=1.20.8-r0 \
        isl25=0.25-r2 \
        libacl=2.3.1-r3 \
        libatomic=12.2.1_git20220924-r10 \
        libcrypto3=3.1.3-r0 \
        libcurl=8.3.0-r0 \
        libexpat=2.5.0-r1 \
        libgcc=12.2.1_git20220924-r10 \
        libgomp=12.2.1_git20220924-r10 \
        libidn2=2.3.4-r1 \
        libncursesw=6.4_p20230506-r0 \
        libssl3=3.1.3-r0 \
        libstdc++=12.2.1_git20220924-r10 \
        libunistring=1.1-r1 \
        libxxhash=0.8.2-r0 \
        lz4-libs=1.9.4-r4 \
        mpc1=1.3.1-r1 \
        mpfr4=4.2.0_p12-r0 \
        musl=1.2.4-r1 \
        musl-dev=1.2.4-r1 \
        ncurses-terminfo-base=6.4_p20230506-r0 \
        nghttp2-libs=1.55.1-r0 \
        pcre2=10.42-r1 \
        popt=1.19-r2 \
        readline=8.2.1-r1 \
        rsync=3.2.7-r4 \
        zlib=1.2.13-r1 \
        zstd-libs=1.5.5-r4 \
        ; \
    curl -sfLo go.tar.gz $ARCHIVE_URL; \
    echo "$ARCHIVE_SUM *go.tar.gz" | sha256sum -wc -; \
    tar -C /usr/local -xzf go.tar.gz; \
    # Bootstrap and install the standard library
    cd /usr/local/go/src && GOROOT_BOOTSTRAP="$(go env GOROOT)" GOHOSTOS="linux" GOHOSTARCH="amd64" ./make.bash; \
    go install std; \
    #Add commonly used go things to rootfs
    apk info -qL bash | rsync -aq --files-from=- / /rootfs/; \
    apk info -qL binutils | rsync -aq --files-from=- / /rootfs/; \
    apk info -qL brotli-libs | rsync -aq --files-from=- / /rootfs/; \
    apk info -qL busybox | rsync -aq --files-from=- / /rootfs/; \
    apk info -qL busybox-binsh | rsync -aq --files-from=- / /rootfs/; \
    apk info -qL ca-certificates | rsync -aq --files-from=- / /rootfs/; \
    apk info -qL gcc | rsync -aq --files-from=- / /rootfs/; \
    apk info -qL git | rsync -aq --files-from=- / /rootfs/; \
    apk info -qL gmp | rsync -aq --files-from=- / /rootfs/; \
    apk info -qL isl25 | rsync -aq --files-from=- / /rootfs/; \
    apk info -qL libacl | rsync -aq --files-from=- / /rootfs/; \
    apk info -qL libatomic | rsync -aq --files-from=- / /rootfs/; \
    apk info -qL libcrypto3 | rsync -aq --files-from=- / /rootfs/; \
    apk info -qL libcurl | rsync -aq --files-from=- / /rootfs/; \
    apk info -qL libexpat | rsync -aq --files-from=- / /rootfs/; \
    apk info -qL libgcc | rsync -aq --files-from=- / /rootfs/; \
    apk info -qL libgomp | rsync -aq --files-from=- / /rootfs/; \
    apk info -qL libidn2 | rsync -aq --files-from=- / /rootfs/; \
    apk info -qL libncursesw | rsync -aq --files-from=- / /rootfs/; \
    apk info -qL libssl3 | rsync -aq --files-from=- / /rootfs/; \
    apk info -qL libstdc++ | rsync -aq --files-from=- / /rootfs/; \
    apk info -qL libunistring | rsync -aq --files-from=- / /rootfs/; \
    apk info -qL libxxhash | rsync -aq --files-from=- / /rootfs/; \
    apk info -qL lz4-libs | rsync -aq --files-from=- / /rootfs/; \
    apk info -qL mpc1 | rsync -aq --files-from=- / /rootfs/; \
    apk info -qL mpfr4 | rsync -aq --files-from=- / /rootfs/; \
    apk info -qL musl | rsync -aq --files-from=- / /rootfs/; \
    apk info -qL musl-dev | rsync -aq --files-from=- / /rootfs/; \
    apk info -qL ncurses-terminfo-base | rsync -aq --files-from=- / /rootfs/; \
    apk info -qL nghttp2-libs | rsync -aq --files-from=- / /rootfs/; \
    apk info -qL pcre2 | rsync -aq --files-from=- / /rootfs/; \
    apk info -qL popt | rsync -aq --files-from=- / /rootfs/; \
    apk info -qL readline | rsync -aq --files-from=- / /rootfs/; \
    apk info -qL rsync | rsync -aq --files-from=- / /rootfs/; \
    apk info -qL zlib | rsync -aq --files-from=- / /rootfs/; \
    apk info -qL zstd-libs | rsync -aq --files-from=- / /rootfs/; \
    \
    go install github.com/google/go-licenses@$GOLICENSETAG; \
    mkdir -p /rootfs /rootfs/go/src /rootfs/go/bin /rootfs/usr/local/go; \
    rsync -ap /usr/local/go/ /rootfs/usr/local/go/; \
    rsync -ap /go/bin/ /rootfs/go/bin/; \
    # Set up the go path
    chmod -R 777 /rootfs/go;

FROM reg.g5d.dev/alpine@sha256:e2b43fe31f5609bc07265b709d41d65dcff433da4e96504e41fbd54861d393f9
ENV GOPATH=/go
ENV PATH=$GOPATH/bin:/usr/local/go/bin:$PATH
COPY --from=build /rootfs /
